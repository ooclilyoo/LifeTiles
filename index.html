<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#f8fafc">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="LifeTiles">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    
    <title>LifeTiles</title>
    
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./icons/icon-180x180.png" />
    <link rel="icon" href="./icons/icon-192x192.png" />
    <link rel="apple-touch-startup-image" href="./icons/icon-512x512.png">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Main Content Area -->
        <main id="main-content">
            <!-- Daily Challenge Tab -->
            <section id="daily-challenge" class="tab-content active">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="nav-btn prev-month" id="prevMonth">‚Äπ</button>
                        <h2 class="month-year" id="monthYear">December 2024</h2>
                        <button class="nav-btn next-month" id="nextMonth">‚Ä∫</button>
                    </div>
                    
                    <div class="calendar-grid" role="grid" aria-label="Calendar">
                        <div class="calendar-weekdays" role="row">
                            <div class="weekday" role="columnheader" aria-label="Sunday">Sun</div>
                            <div class="weekday" role="columnheader" aria-label="Monday">Mon</div>
                            <div class="weekday" role="columnheader" aria-label="Tuesday">Tue</div>
                            <div class="weekday" role="columnheader" aria-label="Wednesday">Wed</div>
                            <div class="weekday" role="columnheader" aria-label="Thursday">Thu</div>
                            <div class="weekday" role="columnheader" aria-label="Friday">Fri</div>
                            <div class="weekday" role="columnheader" aria-label="Saturday">Sat</div>
                        </div>
                        <div class="calendar-days" id="calendarDays" role="rowgroup">
                            <!-- Calendar days will be generated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="calendar-legend">
                        <div class="legend-item">
                            <div class="legend-color success"></div>
                            <span>Success</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color rescued"></div>
                            <span>Rescued</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color failed"></div>
                            <span>Failed</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color pending"></div>
                            <span>Pending</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color has-challenge"></div>
                            <span>Challenge Day</span>
                        </div>
                    </div>
                    
                    <button class="manage-challenges-btn" id="manageChallengesBtn">
                        Manage Challenges
                    </button>
                </div>
            </section>

            <!-- To-Do List Tab -->
            <section id="todo-list" class="tab-content">
                <div class="todo-container">
                    <!-- Single Items Section -->
                    <div class="todo-section">
                        <div class="section-header">
                            <h2>Single Items</h2>
                            <button class="add-btn" id="addSingleItem">+ Add Item</button>
                        </div>
                        <div class="todo-list" id="singleItemsList">
                            <!-- Single items will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Recurring Items Section -->
                    <div class="todo-section">
                        <div class="section-header">
                            <h2>Recurring Items</h2>
                            <button class="add-btn" id="addRecurringItem">+ Add Item</button>
                        </div>
                        <div class="todo-list" id="recurringItemsList">
                            <!-- Recurring items will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Books & Films Tab -->
            <section id="books-films" class="tab-content">
                <div class="books-films-container">
                    <!-- Books Section -->
                    <div class="books-films-section">
                        <div class="section-header">
                            <h2>Books</h2>
                            <button class="add-btn" id="addBook">+ Add Book</button>
                        </div>
                        <div class="books-films-list" id="booksList">
                            <!-- Books will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Films Section -->
                    <div class="books-films-section">
                        <div class="section-header">
                            <h2>Films</h2>
                            <button class="add-btn" id="addFilm">+ Add Film</button>
                        </div>
                        <div class="books-films-list" id="filmsList">
                            <!-- Films will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation Bar -->
        <nav id="bottom-nav" role="tablist" aria-label="Main navigation">
            <button class="nav-tab active" data-tab="daily-challenge" role="tab" aria-selected="true" aria-controls="daily-challenge" tabindex="0">
                <span class="nav-icon" aria-hidden="true">üéØ</span>
                <span class="nav-label">Daily Challenge</span>
            </button>
            <button class="nav-tab" data-tab="todo-list" role="tab" aria-selected="false" aria-controls="todo-list" tabindex="0">
                <span class="nav-icon" aria-hidden="true">üìù</span>
                <span class="nav-label">To-Do List</span>
            </button>
            <button class="nav-tab" data-tab="books-films" role="tab" aria-selected="false" aria-controls="books-films" tabindex="0">
                <span class="nav-icon" aria-hidden="true">üìö</span>
                <span class="nav-label">Books & Films</span>
            </button>
        </nav>
    </div>

    <!-- 1) Êó¢ÊúâÁöÑÂñÆÊ™îÁâà‰∏ªÁ®ãÂºè -->
    <script src="script.js"></script>

    <!-- 2) ShimÔºöÊää script.js ÁöÑÂäüËÉΩÊéõÂà∞Ê®°ÁµÑÂëΩÂêçÁ©∫ÈñìÔºå‰æõ app.js / books-films.js ‰ΩøÁî® -->
    <script>
    // --- CoreÔºöÈÄöÁî®Ë°åÁÇ∫ÔºàË´ãÁî®‰Ω† script.js Êó¢ÊúâÁöÑÂ∞çÊáâÂáΩÂºèÂêçÁ®±Ôºâ---
    window.LifeTilesCore = {
        addTouchEventSupport: (typeof addTouchEventSupport === 'function' ? addTouchEventSupport : () => {}),
        setupTabNavigation: (typeof setupTabNavigation === 'function' ? setupTabNavigation : () => {}),
        activateTab: (typeof activateTab === 'function' ? activateTab : () => {}),
        checkPWAStatus: (typeof checkPWAStatus === 'function' ? checkPWAStatus : () => {}),
        closeModal: (typeof closeModal === 'function' ? closeModal : () => {}),
    };

    // --- StorageÔºölocalStorage ÁöÑÁµ±‰∏ÄÂÖ•Âè£ ---
    window.LifeTilesStorage = {
        initializeLocalStorage: (typeof initializeLocalStorage === 'function' ? initializeLocalStorage : () => {}),
        saveToStorage: (typeof saveToStorage === 'function' ? saveToStorage : () => {}),
        loadFromStorage: (typeof loadFromStorage === 'function' ? loadFromStorage : () => ({})),
        getInitialData: (typeof getInitialData === 'function' ? getInitialData : () => ({})),
    };

    // --- Daily ChallengeÔºàË°å‰∫ãÊõÜÔºâ---
    window.LifeTilesDailyChallenge = {
        initializeCalendar: (typeof initializeCalendar === 'function' ? initializeCalendar : () => {}),
        // Â¶ÇÊûú app.js ÊúÉÂëºÂè´ setupDailyChallengeEventListenersÔºåÂ∞±Êèê‰æõ‰∏ÄÂÄãÂåÖË£ùÂô®
        setupDailyChallengeEventListeners: () => {
        // Á¢∫‰øù‰∏ä‰∏ÄÊúà/‰∏ã‰∏ÄÊúàÁ≠âÊåâÈàïÊúâË¢´Á∂ÅÂÆöÔºàËã• script.js Â∑≤Á∂ìÁ∂ÅÈÅéÔºåÈÄôË£°Â∞±Áï∂‰øùÈö™Ôºâ
        const prev = document.getElementById('prevMonth');
        const next = document.getElementById('nextMonth');
        if (prev && !prev.__ltBound) { prev.addEventListener('click', () => { if (typeof goToPreviousMonth==='function') goToPreviousMonth(); }); prev.__ltBound = true; }
        if (next && !next.__ltBound) { next.addEventListener('click', () => { if (typeof goToNextMonth==='function') goToNextMonth(); }); next.__ltBound = true; }
        // ‰Ω†ÂéüÊú¨Êúâ render/recompute ÁöÑÂáΩÂºèÔºåÂ∞±Âú®ÈúÄË¶ÅÊôÇÂëºÂè´
        if (typeof recomputeCalendarStatuses === 'function') {
            recomputeCalendarStatuses();
        } else if (typeof renderCalendar === 'function') {
            renderCalendar();
        }
        },
    };

    // --- To-DoÔºàÂñÆÊ¨°/ÈÄ±ÊúüÔºâ---
    window.LifeTilesTodo = {
        initializeTodoLists: (typeof initializeTodoLists === 'function' ? initializeTodoLists : () => {}),
        setupTodoEventListeners: () => {
        // Ëã• script.js Â∑≤Á∂ìÈõÜ‰∏≠Á∂ÅÂú®‰∏ÄÂÄã setupEventListeners()ÔºåÈÄôË£°ÂèØ‰ª•Áõ¥Êé•ÂëºÂè´ÂÆÉ„ÄÇ
        if (typeof setupEventListeners === 'function') {
            setupEventListeners();
        } else {
            // ÊàñËÄÖ‰Ω†‰πüËÉΩÂú®ÈÄôË£°Âè™Á∂ÅÂæÖËæ¶ÂçÄÂ°äÈúÄË¶ÅÁöÑÊåâÈàïÔºàaddSingleItem / addRecurringItem Á≠âÔºâ
            const addSingle = document.getElementById('addSingleItem');
            const addRecurring = document.getElementById('addRecurringItem');
            if (addSingle && !addSingle.__ltBound) { addSingle.addEventListener('click', () => { if (typeof openAddSingleItemModal==='function') openAddSingleItemModal(); }); addSingle.__ltBound = true; }
            if (addRecurring && !addRecurring.__ltBound) { addRecurring.addEventListener('click', () => { if (typeof openAddRecurringItemModal==='function') openAddRecurringItemModal(); }); addRecurring.__ltBound = true; }
        }
        },
    };

    // ÊõùÈú≤‰Ω†ÂñÆÊ™îÁâà‰∏≠Â∑≤Á∂ìÂ≠òÂú®„ÄÅ‰ΩÜ app.js ÂèØËÉΩÊúÉÁî®Âà∞ÁöÑËºîÂä©ÂáΩÂºèÔºàË¶ñÈúÄË¶ÅÔºâ
    window.LifeTilesHelpers = {
        recomputeCalendarStatuses: (typeof recomputeCalendarStatuses === 'function' ? recomputeCalendarStatuses : () => {}),
        renderCalendar: (typeof renderCalendar === 'function' ? renderCalendar : () => {}),
    };
    </script>

    <!-- 3) Ê®°ÁµÑÊ™îÔºöÊõ∏/ÈõªÂΩ±Ê∏ÖÂñÆÔºàÈÄôÊîØÈÄöÂ∏∏Â∑≤Á∂ì‰ª• LifeTilesBooksFilms ÊñπÂºèËº∏Âá∫Ôºâ -->
    <script src="./js/books-films.js"></script>

    <!-- 4) Ê®°ÁµÑÁâàÂÖ•Âè£ÔºöÊúÉÂëºÂè´ LifeTilesCore / Storage / Todo / DailyChallenge / BooksFilms -->
    <script src="./js/app.js"></script>

</body>
</html>
